box: python:2.7
dev:
  services:
    - redis
    - id: mattapi
      url: file://../ws_api#dev
      cmd: python /pipeline/source/app.py

  steps:
    - pip-install
    - internal/watch:
        name: start web server
        code: python app.py
        reload: true
build:
  services:
    - redis
    - tonnu/mattapi
  steps:
    - virtualenv
    - pip-install
    - script:
        name: python unit test
        code: |
          python app_test.py
    - script:
        name: copy artifacts
        code: |
          cp app.py requirements.txt $WERCKER_OUTPUT_DIR
deploy:
  box: python:2.7-slim
  steps:
    - pip-install
    - internal/docker-push:
      username: $docker_user
      password: $docker_pass
      repository: tonnu/ws_web
      cmd: python /pipeline/source/app.py
      ports: "5001"
